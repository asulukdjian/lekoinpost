
<div class="container mt-2">
  <div class="dashboard-content">

    <% unless current_user.gardens.empty? %>
      <div class="dashboard-gardens">
        <h2>My gardens</h2>
        <p>
          <% @my_gardens.each do |garden| %>
            <div class="card-appointment">
              <% if garden.photos.attached? %>
                <%= cl_image_tag garden.photos.first.key, class:"card-img" %>
              <% end %>
              <div class="card-appointment-infos">
                <h2><%= link_to garden.name, garden_path(garden) %></h2>
                <p>📪  <%=  garden.address %></p>
                <p> <%= garden.description %></p>
                <p> <div class="garden-action"><%= link_to "Modify", edit_garden_path(garden) %></div> </p>
              </div>
            </div>
          <% end %>
        </p>
        <br>
        <p>
          <h2>Reservations checklist</h2>
          <% current_user.gardens.each do |garden| %>
            <h6><%= garden.name %></h6>
            
            <% current_user.appointments_for_gardens.where.not(status:"refused").each do |appointment_for_gardens| %>
              <% if appointment_for_gardens.delivered == nil %>
                <div class="card-reservation">
                  <% if appointment_for_gardens.garden.photos.attached? %>
                    <%= cl_image_tag appointment_for_gardens.garden.photos.first.key, class:"card-img" %>
                  <% end %>
                  <div class="card-reservation-infos">
                    <% unless appointment_for_gardens.status == "accepted" %>
                      <%= appointment_for_gardens.user.first_name %>
                      <%= appointment_for_gardens.date.strftime('%A, %d %b %Hh') %>
                      <%= link_to "✅ Accept reservation", accept_appointment_path(appointment_for_gardens)%>
                      <%= link_to "❌ Refuse reservation", refuse_appointment_path(appointment_for_gardens)%>
                    <% else %>
                      <h2> 📅 Reservation scheduled on <%= appointment_for_gardens.date.strftime('%A, %d %b %Hh') %> </h2>
                      <%= link_to "✅ Confirm delivery", deliver_appointment_path(appointment_for_gardens)%>
                      <%= link_to "❌Delivery canceled", canceldeliver_appointment_path(appointment_for_gardens)%>
                    <% end %>
                  </div>
                </div>
              <% end %>
            <% end %>
          <% end %>
        </p>
      </div>
    <% end %>

    <div class="dashboard-appointments">
      <% if current_user.gardens.any? %>
        <h2>Reservations agenda</h2>
        <p>
          <div class="gardenCalendar" data-events="<%= @events.to_json %>"></div>
        </p>
      <% else %>
        <h2>My appointments</h2>
        <p>
          <% @my_appointments.each do |appointment|  %>
            <div class="card-appointment">
              <% if appointment.garden.photos.attached? %>
                <%= cl_image_tag appointment.garden.photos.first.key, class:"card-img" %>
              <% end %>
              <div class="card-appointment-infos">
                <h2><%= link_to appointment.garden.name, garden_path(appointment.garden) %></h2>
                <p>📅  <%= appointment.date.strftime("%b %d, %Y") %></p>
                <p>🕗  <%= appointment.date.strftime("%H:%M") %></p>
                <p>🧺  <%= appointment.quantity %> kg</p>
                <% if policy(appointment).edit? %>
                  <span>🖍 <%= link_to "Modify", edit_appointment_path(appointment) %></span>
                <% end %>
                <% if policy(appointment).destroy? %>
                  <span>❌<%= link_to "delete",
                    appointment_path(appointment),
                    method: :delete,
                    data: { confirm: "Are you sure?"
                    } %></span>
                <% end %>
                <% if appointment.chatroom %>
                  <%= link_to "Chat", chatroom_path(appointment.chatroom) %>
                <% end %>
              </div>
            </div>
          <% end %>
        </p>
      <% end %>
    </div>

  </div>
  <div class="back-garden-button"><%= link_to "⬅ back to gardens", gardens_path, id: "btn-back" %></div>
</div>

