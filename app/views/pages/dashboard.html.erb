<div class="container mt-2">
  <div class="dashboard-content">
    <% unless current_user.gardens.empty? %>
      <div class="dashboard-gardens">
        <h2>My gardens</h2>
        <p>
          <% @my_gardens.each do |garden| %>
            <div class="card-appointment">
              <% if garden.photos.attached? %>
                <%= cl_image_tag garden.photos.first.key, class:"card-img" %>
              <% end %>
              <div class="card-appointment-infos h-100 w-100 p-2" >
                <h2><%= link_to garden.name, garden_path(garden) %></h2>
                <p>ğŸ“ª  <%=  garden.address %></p>
                <p>ğŸ… <%= garden.reward_score %> points</p>
                <div class="d-flex justify-content-center align-items-center">
                  <%= link_to "ğŸ– Modify", edit_garden_path(garden), class: "btn btn-primary" %>
                  <%= link_to "ğŸ—‘ Delete", garden_path(garden), method: :delete, data: { confirm: "Do you really want to delete \"#{garden.name}\" ?"}, class: "text-danger ml-2" %>
                </div>
              </div>
            </div>
          <% end %>
        </p>
        <br>
        <p>
          <h2>Reservations checklist</h2>
          <% current_user.gardens.each do |garden| %>
            <h6><%= garden.name %></h6>
            <% current_user.appointments_for_gardens.where(garden: garden).where.not(status:"refused").each do |appointment_for_gardens| %>
              <% if appointment_for_gardens.delivered == nil %>
                <div class="card-reservation">
                  <% if appointment_for_gardens.garden.photos.attached? %>
                    <%= cl_image_tag appointment_for_gardens.garden.photos.first.key, class:"card-img" %>
                  <% end %>
                  <div class="card-reservation-infos">
                    <% unless appointment_for_gardens.status == "accepted" %>
                      <p>ğŸ‘¨ <%= appointment_for_gardens.user.first_name %></p>
                      <p>ğŸ“… <%= appointment_for_gardens.date.strftime('%A, %d %b %Hh') %></p>
                      <p><%= link_to "âœ… Accept reservation", accept_appointment_path(appointment_for_gardens)%>
                      <%= link_to "âŒ Refuse reservation", refuse_appointment_path(appointment_for_gardens)%></p>
                    <% else %>
                      <h2> ğŸ“… Reservation scheduled on <%= appointment_for_gardens.date.strftime('%A, %d %b %Hh') %> </h2>
                      <p><%= link_to "âœ… Confirm delivery", deliver_appointment_path(appointment_for_gardens)%>
                      <%= link_to "âŒDelivery canceled", canceldeliver_appointment_path(appointment_for_gardens)%></p>
                    <% end %>
                  </div>
                <%= link_to "ğŸ’¬Chat", chatroom_path(appointment_for_gardens.chatroom) %>
                </div>
              <% end %>
            <% end %>
          <% end %>
        </p>
      </div>
    <% end %>
    <div class="dashboard-appointments">
      <% if current_user.gardens.any? %>
        <h2>Reservations agenda</h2>
        <p>
          <div class="gardenCalendar" data-events="<%= @events.to_json %>"></div>
        </p>
      <% else %>
      <%= render partial: "pages/dashboard_partial/dashboard_clara", locals:{appointments: @my_appointments}%>
      <% end %>
    </div>
  </div>
  <div class="back-garden-button"><%= link_to "â¬… back to gardens", gardens_path, id: "btn-back" %></div>
</div>

